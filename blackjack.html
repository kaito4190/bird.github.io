<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Blackjack </title>
<style>
  body { font-family: sans-serif; text-align: center; margin: 20px; }
  .cards { margin: 10px; min-height: 24px; }
  .controls { margin-top: 8px; }
  button { margin: 5px; padding: 8px 12px; }
  #message { font-weight: 600; margin-top: 8px; }
</style>
</head>
<body>
<h1>Blackjack</h1>
<p id="message">Click Deal to start</p>

<h3>Dealer (<span id="dealerScore">?</span>)</h3>
<div id="dealerCards" class="cards"></div>

<h3>You (<span id="playerScore">?</span>)</h3>
<div id="playerCards" class="cards"></div>

<div class="controls">
  <button id="deal">Deal</button>
  <button id="hit" disabled>Hit</button>
  <button id="stand" disabled>Stand</button>
  <button id="newRound" disabled>New Round</button>
</div>

<script>
// Example JSON: game settings
const gameSettingsJSON = '{ "standLimit": 17, "blackjackValue": 21 }';
const gameSettings = JSON.parse(gameSettingsJSON);

// Arrays, objects, and array of objects
let deck = [];          // array of card objects
let player = [];        // array of objects
let dealer = [];        // array of objects

// Object example: statistics
let stats = {
  gamesPlayed: 0,
  wins: 0,
  losses: 0,
  pushes: 0
};

let inRound = false;
let dealerHidden = true;

// FUNCTION: Create deck using loops and objects
function createDeck() {
  const suits = ["♠","♥","♦","♣"];
  const ranks = ["A","2","3","4","5","6","7","8","9","10","J","Q","K"];
  let d = [];

  // Loop creating array of objects
  for (let s of suits) {
    for (let r of ranks) {
      d.push({ suit: s, rank: r });
    }
  }

  // Shuffle
  for (let i = d.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [d[i], d[j]] = [d[j], d[i]];
  }
  return d;
}

// FUNCTION: card value
function value(rank) {
  if (rank === "A") return 11;
  if (["K","Q","J"].includes(rank)) return 10;
  return Number(rank);
}

// FUNCTION: hand total
function handValue(hand) {
  let total = 0;
  let aces = 0;

  for (const card of hand) {
    total += value(card.rank);
    if (card.rank === "A") aces++;
  }

  while (total > gameSettings.blackjackValue && aces > 0) {
    total -= 10;
    aces--;
  }
  return total;
}

// FUNCTION: update screen
function render() {
  function cardText(card, hide) {
    return hide ? "[Hidden]" : `${card.rank}${card.suit}`;
  }

  document.getElementById("dealerCards").innerHTML =
    dealer.map((c, i) => cardText(c, dealerHidden && i === 0)).join(" ");

  document.getElementById("playerCards").innerHTML =
    player.map(c => `${c.rank}${c.suit}`).join(" ");

  document.getElementById("dealerScore").textContent = dealerHidden ? "?" : handValue(dealer);
  document.getElementById("playerScore").textContent = handValue(player);
}

function setMsg(msg) {
  document.getElementById("message").textContent = msg;
}

function setControls(obj) {
  Object.keys(obj).forEach(id => {
    document.getElementById(id).disabled = !obj[id];
  });
}

// GAME FLOW
function deal() {
  deck = createDeck();
  player = [];
  dealer = [];
  dealerHidden = true;
  inRound = true;
  stats.gamesPlayed++;

  player.push(deck.pop(), deck.pop());
  dealer.push(deck.pop(), deck.pop());

  render();

  const p = handValue(player);
  const d = handValue(dealer);

  checkOpening(p, d);
}

// Check opening conditions
function checkOpening(p, d) {
  if (p === 21 && d === 21) return endRound("Double Blackjack. Push.", "pushes");
  if (p === 21) return endRound("Blackjack! You win!", "wins");
  if (d === 21) return endRound("Dealer Blackjack! Dealer wins.", "losses");

  setMsg("Hit or Stand?");
  setControls({ deal:false, hit:true, stand:true, newRound:false });
}

function hit() {
  if (!inRound) return;
  player.push(deck.pop());
  render();

  const p = handValue(player);
  if (p > 21) return endRound("Bust! Dealer wins.", "losses");
  if (p === 21) return endRound("21! You win!", "wins");
}

function stand() {
  if (!inRound) return;
  dealerHidden = false;
  render();

  while (handValue(dealer) < gameSettings.standLimit) {
    dealer.push(deck.pop());
  }

  const p = handValue(player);
  const d = handValue(dealer);

  if (d > 21 || p > d) return endRound("You win!", "wins");
  if (p < d) return endRound("Dealer wins.", "losses");
  return endRound("Push.", "pushes");
}

function endRound(message, statKey) {
  inRound = false;
  dealerHidden = false;
  render();

  setMsg(message);
  stats[statKey]++;

  setControls({ deal:false, hit:false, stand:false, newRound:true });
}

function newRound() {
  player = [];
  dealer = [];
  dealerHidden = true;
  inRound = false;
  render();
  setMsg("Click Deal to start");
  setControls({ deal:true, hit:false, stand:false, newRound:false });
}

// BUTTONS
document.getElementById("deal").onclick = deal;
document.getElementById("hit").onclick = hit;
document.getElementById("stand").onclick = stand;
document.getElementById("newRound").onclick = newRound;

// INIT
newRound();
</script>
</body>
</html>
